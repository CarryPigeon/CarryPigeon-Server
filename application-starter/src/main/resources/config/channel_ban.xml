<?xml version="1.0" encoding="UTF-8"?>
<flow>
    <!-- 创建频道封禁 -->
    <chain name="/core/channel/ban/create">
        THEN(
        /** 判断用户是否登录 **/
        UserLoginChecker,
        /** 将 SessionId 映射为 UserInfo_Id，供管理员校验使用 **/
        RenameArg.bind("key","UserInfo_Id:SessionId"),
        /** 查询频道信息 **/
        CPChannelSelector.bind("key","id"),
        /** 校验当前用户是否为频道管理员 **/
        CPChannelAdminChecker,
        /** 查询被封禁目标成员信息 **/
        CPChannelMemberSelector.bind("key","CidWithUid"),
        /** 检查封禁目标是否合法（不可封禁管理员） **/
        CPChannelBanTargetChecker,
        /** 保存封禁记录 **/
        CPChannelBanSaver,
        /** 收集频道所有成员用于通知 **/
        CPChannelMemberCollector,
        /** 通知频道内所有成员 **/
        CPNotifier.bind("route","/core/channel/ban/list")
        )
    </chain>

    <!-- 删除频道封禁 -->
    <chain name="/core/channel/ban/delete">
        THEN(
        /** 判断用户是否登录 **/
        UserLoginChecker,
        /** 将 SessionId 映射为 UserInfo_Id，供管理员校验使用 **/
        RenameArg.bind("key","UserInfo_Id:SessionId"),
        /** 查询频道信息 **/
        CPChannelSelector.bind("key","id"),
        /** 校验当前用户是否为频道管理员 **/
        CPChannelAdminChecker,
        /** 查询封禁记录 **/
        CPChannelBanSelector,
        /** 删除封禁记录 **/
        CPChannelBanDeleter,
        /** 收集频道所有成员用于通知 **/
        CPChannelMemberCollector,
        /** 通知频道内所有成员 **/
        CPNotifier.bind("route","/core/channel/ban/list")
        )
    </chain>

    <!-- 获取频道封禁列表 -->
    <chain name="/core/channel/ban/list">
        THEN(
        /** 判断用户是否登录 **/
        UserLoginChecker,
        /** 将 SessionId、频道 id 映射为成员选择所需的参数 **/
        RenameArg.bind("key","ChannelMemberInfo_Uid:SessionId;ChannelMemberInfo_Cid:ChannelInfo_Id"),
        /** 确认当前用户在频道中 **/
        CPChannelMemberSelector.bind("key","CidWithUid"),
        /** 拉取封禁列表 **/
        CPChannelBanLister
        )
    </chain>
</flow>

