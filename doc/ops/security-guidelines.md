# 安全基线指南

> 本文定义当前版本的安全基线，面向接口、鉴权、数据与插件扩展。

## 1. 传输与认证

- 生产环境必须启用 TLS（HTTPS/WSS）
- HTTP 认证统一 `Authorization: Bearer <access_token>`
- WebSocket 连接后必须先发送 `auth`，未鉴权不得订阅业务事件
- token 过期与无权限错误需按 `reason` 明确区分

## 2. 接口与权限

- 所有受保护端点必须经过访问令牌校验
- 频道相关能力必须校验成员/管理员/owner 权限
- required gate 必须在登录阶段强制执行
- 错误统一输出 `error.reason`，禁止返回模糊错误文案作为唯一依据

## 3. 输入与数据安全

- 请求参数强校验（类型、长度、枚举、范围）
- domain 数据按契约校验（schema / 大小 / 深度）
- 文件上传校验类型与大小，下载授权校验访问范围
- 任何外部输入都不得直接拼接为 SQL/脚本/路径

## 4. 敏感信息治理

- 密钥、密码、token 禁止硬编码入仓库
- 敏感配置通过环境变量或密钥系统注入
- 日志中禁止输出 token 与密钥原文
- 生产环境最小化调试日志与错误回显细节

## 5. 插件安全

- 插件仅依赖 `api` 稳定边界，禁止直接依赖宿主内部实现
- 插件权限最小化，默认拒绝高危能力
- 插件包扫描启用白名单/签名/校验策略（按配置）
- 插件异常不得拖垮核心链路，必须可降级

## 6. 安全检查清单

- [ ] TLS 与证书配置正确
- [ ] token、required gate、权限校验完整
- [ ] 错误模型符合 `doc/api/13-错误模型与Reason枚举.md`
- [ ] 文件与插件下载链路可防滥用
- [ ] 关键操作有审计日志且不泄露敏感信息
