# 插件生命周期规范

> 插件生命周期应具备“可加载、可升级、可回滚、可观测”的工程属性。

## 1. 生命周期阶段

1. 发现：扫描插件包并读取 manifest
2. 校验：校验元数据、兼容性与安全策略
3. 装配：注册 Bean / 节点并接入链路
4. 运行：按配置开关执行业务
5. 卸载或停用：释放资源，移除扩展点

## 2. 升级策略

- 升级前记录当前版本与配置
- 灰度启用新版本，观察错误率与延迟
- 出现异常时快速回滚到稳定版本

## 3. 资源治理

- 必须显式关闭线程池、连接、定时任务
- 避免插件持有无限增长的本地缓存
- 启停流程输出结构化日志（版本、耗时、结果）

## 4. 故障处理

- 初始化失败：插件标记为禁用，不影响宿主启动
- 运行时异常：根据插件级别选择降级或熔断
- 不允许插件异常导致核心 API 全面不可用

## 5. 观测建议

- 记录插件加载耗时、错误次数、影响链路
- 统计插件开关状态与版本分布
